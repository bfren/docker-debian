#!/bin/bash

set -euo pipefail


#======================================================================================================================
# Check arguments.
#   1   Valid timezone (e.g. Europe/London)
#======================================================================================================================

[[ -z "${1-}" ]] && bf-error "You must provide a timezone." "bf-tz"
TZ=/usr/share/zoneinfo/${1}


#======================================================================================================================
# Set the timezone.
#======================================================================================================================

# remove timezone packages and clear zone info
clear() {
    bf-debug "Removing tzdata packages." "bf-tz"
    apt purge tzdata -y
    rm -rf /usr/share/zoneinfo/*
}

# install timezone package
bf-debug "Installing tzdata packages." "bf-tz"
apt install tzdata -y

# check the specified timezone exists
if [ ! -f "${TZ}" ] ; then
    clear
    bf-error "${1} is not a recognised timezone." "bf-tz"
fi

# copy timezone info
bf-echo "Setting timezone to ${1}..." "bf-tz"
cp "${TZ}" /etc/localtime
clear
bf-done "bf-tz"
