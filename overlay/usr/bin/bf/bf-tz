#!/bin/bash

set -euo pipefail


#======================================================================================================================
# Check arguments.
#   1   Valid timezone (e.g. Europe/London)
#======================================================================================================================

[[ -z "${1-}" ]] && bf-error "You must provide a timezone." "bf-tz"
TZ=${1}
ZONE_INFO=/usr/share/zoneinfo


#======================================================================================================================
# Set the timezone.
#======================================================================================================================

# remove timezone packages and clear zone info
clear() {
    bf-debug "Removing tzdata packages." "bf-tz"
    apt remove tzdata -yq
    rm -rf ${ZONE_INFO}/*
}

# install timezone package
bf-debug "Installing tzdata packages." "bf-tz"
apt update && apt install tzdata -y

# check the specified timezone exists
if [ ! -f "${ZONE_INFO}/${TZ}" ] ; then
    clear
    bf-error "${TZ} is not a recognised timezone." "bf-tz"
fi

# set timezone info
bf-echo "Setting timezone to ${TZ}..." "bf-tz"
ln -sf ${ZONE_INFO}/${TZ} /etc/localtime
echo "${TZ}" | tee /etc/timezone && dpkg-reconfigure --frontend noninteractive tzdata
clear
bf-done "bf-tz"
